# ğŸ”§ è¿è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬ - è¯¦ç»†æ­¥éª¤

## âš ï¸ å½“å‰é—®é¢˜

æ‰€æœ‰ä¸‰ä¸ªè¡¨ï¼ˆleads, enquiries, enrolmentsï¼‰éƒ½æ˜¾ç¤ºæƒé™é”™è¯¯ã€‚éœ€è¦è¿è¡Œ SQL è„šæœ¬æ¥ä¿®å¤ã€‚

## âœ… è§£å†³æ­¥éª¤

### æ­¥éª¤ 1: æ‰“å¼€ Supabase Dashboard

1. è®¿é—®ï¼šhttps://supabase.com/dashboard
2. ç™»å½•ä½ çš„è´¦æˆ·
3. é€‰æ‹©é¡¹ç›®ï¼š**oaqtpolyinvacxopvdfa**ï¼ˆæˆ–ä½ çš„é¡¹ç›®åç§°ï¼‰

### æ­¥éª¤ 2: æ‰“å¼€ SQL Editor

1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**ï¼ˆSQL ç¼–è¾‘å™¨ï¼‰
2. ç‚¹å‡»å³ä¸Šè§’çš„ **New query**ï¼ˆæ–°å»ºæŸ¥è¯¢ï¼‰æŒ‰é’®

### æ­¥éª¤ 3: å¤åˆ¶ SQL è„šæœ¬

**æ–¹æ³• A: ä½¿ç”¨æœ€ç»ˆä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰**

1. åœ¨é¡¹ç›®ä¸­æ‰“å¼€ `fix-permissions-final.sql` æ–‡ä»¶
2. **å…¨é€‰æ‰€æœ‰å†…å®¹**ï¼ˆCtrl+Aï¼‰
3. **å¤åˆ¶**ï¼ˆCtrl+Cï¼‰

**æ–¹æ³• B: ä½¿ç”¨åŸå§‹ä¿®å¤è„šæœ¬**

1. åœ¨é¡¹ç›®ä¸­æ‰“å¼€ `fix-leads-permission.sql` æ–‡ä»¶
2. **å…¨é€‰æ‰€æœ‰å†…å®¹**ï¼ˆCtrl+Aï¼‰
3. **å¤åˆ¶**ï¼ˆCtrl+Cï¼‰

### æ­¥éª¤ 4: ç²˜è´´å¹¶è¿è¡Œ

1. åœ¨ Supabase SQL Editor ä¸­**ç²˜è´´**ï¼ˆCtrl+Vï¼‰åˆšæ‰å¤åˆ¶çš„ SQL ä»£ç 
2. ç‚¹å‡»å³ä¸‹è§’çš„ **Run**ï¼ˆè¿è¡Œï¼‰æŒ‰é’®
   - æˆ–è€…æŒ‰å¿«æ·é”® `F5`
   - æˆ–è€…æŒ‰ `Ctrl+Enter`

### æ­¥éª¤ 5: æŸ¥çœ‹ç»“æœ

è¿è¡Œåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **RLS çŠ¶æ€éªŒè¯ç»“æœ**ï¼š
   ```
   tablename | rls_enabled | status
   ----------|-------------|----------
   leads     | false       | âœ… RLS å·²ç¦ç”¨
   enquiries | false       | âœ… RLS å·²ç¦ç”¨
   enrolments| false       | âœ… RLS å·²ç¦ç”¨
   ```

2. **å®Œæˆæ¶ˆæ¯**ï¼š
   ```
   âœ… ä¿®å¤å®Œæˆï¼æ‰€æœ‰è¡¨å·²åˆ›å»ºï¼ŒRLS å·²ç¦ç”¨ï¼Œæƒé™å·²é…ç½®ã€‚
   ```

3. **æƒé™æµ‹è¯•æ¶ˆæ¯**ï¼š
   ```
   âœ… æƒé™æµ‹è¯•é€šè¿‡ï¼
   ```

### æ­¥éª¤ 6: éªŒè¯ä¿®å¤

1. **åˆ·æ–°å¥åº·æ£€æŸ¥é¡µé¢**ï¼š
   ```
   http://localhost:3000/api/health
   ```

2. **åº”è¯¥çœ‹åˆ°**ï¼š
   ```json
   {
     "envVars": {
       "supabaseUrl": true,
       "supabaseAnonKey": true,
       "supabaseServiceKey": true
     },
     "supabaseConnection": true,
     "databaseTables": {
       "leads": true,
       "enquiries": true,
       "enrolments": true
     },
     "errors": []
   }
   ```

## ğŸ” å¦‚æœä»ç„¶æœ‰é”™è¯¯

### æ£€æŸ¥ 1: ç¡®è®¤è„šæœ¬å·²è¿è¡Œ

åœ¨ Supabase SQL Editor ä¸­è¿è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š

```sql
SELECT 
  tablename, 
  rowsecurity as rls_enabled
FROM pg_tables 
WHERE schemaname = 'public' 
AND tablename IN ('leads', 'enquiries', 'enrolments');
```

**æ‰€æœ‰è¡¨çš„ `rls_enabled` åº”è¯¥æ˜¯ `false`**

### æ£€æŸ¥ 2: ç¡®è®¤è¡¨å­˜åœ¨

```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('leads', 'enquiries', 'enrolments');
```

**åº”è¯¥è¿”å›ä¸‰ä¸ªè¡¨å**

### æ£€æŸ¥ 3: æ‰‹åŠ¨ç¦ç”¨ RLSï¼ˆå¦‚æœè„šæœ¬å¤±è´¥ï¼‰

å¦‚æœè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œï¼š

```sql
ALTER TABLE public.leads DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.enquiries DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.enrolments DISABLE ROW LEVEL SECURITY;
```

### æ£€æŸ¥ 4: ç¡®è®¤ Service Role Key

ç¡®ä¿ `.env.local` ä¸­ä½¿ç”¨çš„æ˜¯ **service_role** keyï¼Œä¸æ˜¯ anon keyã€‚

## ğŸ“ å¸¸è§é”™è¯¯

### é”™è¯¯: "relation does not exist"
- **åŸå› **: è¡¨ä¸å­˜åœ¨
- **è§£å†³**: è¿è¡Œå®Œæ•´çš„ `fix-permissions-final.sql` è„šæœ¬

### é”™è¯¯: "permission denied"
- **åŸå› **: RLS ä»ç„¶å¯ç”¨æˆ–æƒé™æœªæˆäºˆ
- **è§£å†³**: ç¡®ä¿è„šæœ¬å®Œå…¨è¿è¡Œï¼Œæ£€æŸ¥ RLS çŠ¶æ€

### é”™è¯¯: "syntax error"
- **åŸå› **: SQL ä»£ç å¤åˆ¶ä¸å®Œæ•´
- **è§£å†³**: é‡æ–°å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å†…å®¹

## âš ï¸ é‡è¦æç¤º

- è„šæœ¬æ˜¯**å®‰å…¨çš„**ï¼Œä¸ä¼šåˆ é™¤ç°æœ‰æ•°æ®
- å¦‚æœè¡¨å·²å­˜åœ¨ï¼Œ`CREATE TABLE IF NOT EXISTS` ä¸ä¼šè¦†ç›–
- ç¦ç”¨ RLS åï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯ä»¥è®¿é—®è¡¨ï¼ˆé€‚åˆå¼€å‘ç¯å¢ƒï¼‰
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ RLS å¹¶é…ç½®é€‚å½“çš„ç­–ç•¥
